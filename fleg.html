<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marché Fruits, Légumes & Unités</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
body { background:#f8fff5; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; padding-top:80px; padding-bottom:80px;}
header,footer{position:fixed;left:0;right:0;padding:1rem;color:#fff;z-index:1030;box-shadow:0 4px 6px rgba(0,0,0,0.1);}
header{top:0;display:flex;justify-content:space-between;align-items:center;background:linear-gradient(90deg,#28a745,#5cd65c);border-bottom:3px solid #fff;}
footer{bottom:0;text-align:center;background:linear-gradient(90deg,#28a745,#5cd65c);border-top:3px solid #fff;}
header h1{font-size:1.4rem;font-weight:bold;margin:0;}
.cart-icon{position:relative;cursor:pointer;}
.cart-badge{
  position: absolute;
  top: -12px;
  right: -12px;
  background: #ffc107;
  color: #000;
  border-radius: 50%;
  padding: 4px 8px;
  font-size: 0.85rem;
  font-weight: bold;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}
.filter-container{margin-bottom:20px;}
.product-card{border:2px solid #28a745;border-radius:15px;margin-bottom:1.5rem;padding:1rem;background:#fff;text-align:center;box-shadow:0 6px 12px rgba(0,0,0,0.1);transition:transform 0.3s,box-shadow 0.3s;}
.product-card:hover{transform:translateY(-5px);box-shadow:0 10px 20px rgba(0,0,0,0.2);}
.product-card.added{animation:addedAnim 0.5s ease forwards;}
@keyframes addedAnim{0%{transform:scale(1);}50%{transform:scale(1.05);background:#d4ffd4;}100%{transform:scale(1);background:#fff;}}
.product-card img{border-radius:12px;margin-bottom:1rem;border:1px solid #ddd;}
.product-title{font-size:1.2rem;font-weight:700;margin-bottom:0.5rem;color:#28a745;}
.price{font-size:1rem;color:#dc3545;margin-bottom:0.6rem;font-weight:bold;}
.total-price{font-size:0.95rem;color:#000;font-weight:600;margin-bottom:0.6rem;}
.quantity-control{display:flex;justify-content:center;align-items:center;gap:10px;margin-bottom:1rem;}
.quantity-control button{background:#28a745;color:#fff;border:none;border-radius:8px;width:36px;height:36px;font-size:1.2rem;}
.quantity-control button:hover{background:#1e7e34;}
.quantity-display{font-weight:600;font-size:1rem;min-width:100px;}
.btn-add{background:linear-gradient(90deg,#dc3545,#ff6b6b);border:none;border-radius:10px;color:#fff;padding:0.6rem;width:100%;font-weight:600;}
.btn-add:hover{background:linear-gradient(90deg,#a71d2a,#ff4d4d);}
.modal-content{border-radius:20px;display:flex;flex-direction:column;max-height:80vh;}
.modal-header,.modal-footer{position:sticky;z-index:10;}
.modal-header{top:0;background:linear-gradient(90deg,#28a745,#5cd65c);color:#fff;}
.modal-footer{bottom:0;background:#fff;border-top:2px solid #28a745;}
.modal-body{overflow-y:auto;}
.form-control{border:1px solid #28a745;border-radius:8px;margin-bottom:12px;padding:0.6rem;}
.remove-btn{color:#dc3545;cursor:pointer;font-size:1.2rem;}
.remove-btn:hover{color:#ff6b6b;}
.fruits-card{border-color:#28a745;background:#e9fbe9;}
.legumes-card{border-color:#ffc107;background:#fff9e6;}
.unite-card{border-color:#007bff;background:#e6f0ff;}
@media(max-width:576px){.filter-btns{display:none;}}
</style>
</head>
<body>
<header>
<h1>Marché Fruits & Légumes</h1>
<div class="cart-icon" data-bs-toggle="modal" data-bs-target="#cartModal">
  <i class="fas fa-shopping-cart fa-2x"></i>
  <span class="cart-badge" id="cart-count">0</span>
</div>
</header>

<main class="container mt-3">
<div class="filter-container text-center">
<select id="filter-select" class="form-select w-50 mx-auto">
<option value="all" selected>Tous</option>
<option value="fruits">Fruits</option>
<option value="legumes">Légumes</option>
<option value="unite">Unités</option>
</select>
</div>
<div id="products-list" class="row"></div>
</main>

<footer>
&copy; 2025 Marché Fruits & Légumes <br>
Créé Par : M.Seddik ELidrissi
</footer>

<div class="modal fade" id="cartModal" tabindex="-1">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Votre Panier</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<div id="cart-items"></div>
<hr>
<input type="text" class="form-control" id="client-name" placeholder="Nom complet">
<input type="text" class="form-control" id="client-address" placeholder="Adresse">
<textarea class="form-control" id="client-comment" placeholder="Commentaire"></textarea>
</div>
<div class="modal-footer">
<button class="btn btn-success w-100" onclick="validateOrder()">Valider la commande</button>
</div>
</div>
</div>
</div>

<script>
const fruits = [
{id:1,name:"Pomme",price:5,img:"https://via.placeholder.com/400x250?text=Pomme"},
{id:2,name:"Banane",price:5.49,img:"images/banane.jpg"}
];
const legumes = [
{id:3,name:"Carotte",price:2.48,img:"images/carotte.jpg"},
{id:4,name:"Tomate",price:1.74,img:"images/tomate.jpg"},
{id:5,name:"Pomme de terre blanche",price:1.88,img:"images/pdb.jpg"},
{id:6,name:"Concombre court",price:2.48,img:"images/concombre.jpg"},
{id:7,name:"Courgette blanche",price:2.48,img:"images/corb.jpg"},
{id:8,name:"Aubergine ronde",price:2.10,img:"images/aubergine.jpg"},
{id:9,name:"Coings",price:4.73,img:"images/coing.jpg"},
{id:10,name:"Gombo",price:15.95,img:"images/gombo.jpg"},
{id:11,name:"Poivron vert",price:2.60,img:"images/pvert.jpg"},
{id:12,name:"Haricots vert",price:8.25,img:"images/hvert.jpg"}
];
const unites = [
{id:13,name:"Oeuf",price:3,img:"https://via.placeholder.com/400x250?text=Oeuf"},
{id:14,name:"Citron",price:2,img:"https://via.placeholder.com/400x250?text=Citron"}
];

const products = [...fruits.map(p=>({...p, category:'fruits'})), 
                  ...legumes.map(p=>({...p, category:'legumes'})), 
                  ...unites.map(p=>({...p, category:'unite'}))];

let cart=[]; let quantities={}; products.forEach(p=>quantities[p.id]=1);

function renderProducts(filter='all'){
const c=document.getElementById("products-list");c.innerHTML="";
products.filter(p=>filter==='all'||p.category===filter).forEach(p=>{
let cls=p.category+"-card";
let qtyDisplay=p.category==='unite'?`${quantities[p.id]} unité(s)`:`${quantities[p.id]} × 250g = ${quantities[p.id]*250}g`;
let totalPrice=(p.price*quantities[p.id]).toFixed(2);
c.innerHTML+=`
<div class="col-12">
<div class="product-card ${cls}" id="card-${p.id}">
<img src="${p.img}" alt="${p.name}" class="img-fluid">
<div class="product-title">${p.name}</div>
<div class="price">${p.price} DH ${p.category==='unite'?'/ unité':'/ 250g'}</div>
<div class="total-price">Total: ${totalPrice} DH</div>
<div class="quantity-control">
<button onclick="changeQty(${p.id},-1)">-</button>
<span id="qty-${p.id}" class="quantity-display">${qtyDisplay}</span>
<button onclick="changeQty(${p.id},1)">+</button>
</div>
<button class="btn-add" onclick="addToCart(${p.id})"><i class="fas fa-cart-plus"></i> Ajouter</button>
</div></div>`;});
}

document.getElementById('filter-select').addEventListener('change',()=>{
let sel=document.getElementById('filter-select').value;
renderProducts(sel);
let text=sel==='all'?'Tous les produits':sel==='fruits'?'Fruits':sel==='legumes'?'Légumes':'Unités';
Swal.fire({title:'Filtre appliqué',text:`Vous filtrez: ${text}`,icon:'info',timer:1200,showConfirmButton:false});
});

function changeQty(id,d){
quantities[id]=Math.max(1,(quantities[id]||1)+d);
const p=products.find(pr=>pr.id===id);
let qtyDisplay=p.category==='unite'?`${quantities[id]} unité(s)`:`${quantities[id]} × 250g = ${quantities[id]*250}g`;
document.getElementById(`qty-${id}`).textContent=qtyDisplay;
let totalPrice=(p.price*quantities[id]).toFixed(2);
document.querySelector(`#card-${id} .total-price`).textContent=`Total: ${totalPrice} DH`;
}

function addToCart(id){
const p=products.find(pr=>pr.id===id);const qty=quantities[id];
const grams=p.category==='unite'?qty:qty*250;
if(cart.find(x=>x.id===id)){Swal.fire({title:'Déjà au panier',text:`${p.name} est déjà dans le panier`,icon:'warning'});return;}
cart.push({...p,qty,grams});
updateCartCount();renderCart();
document.getElementById(`card-${id}`).classList.add('added');
setTimeout(()=>{document.getElementById(`card-${id}`).classList.remove('added');},500);
Swal.fire({icon:'success',title:'Ajouté!',text:`${p.name} ajouté avec ${p.category==='unite'?qty+' unité(s)':grams+'g'}`});
}

function updateCartCount(){document.getElementById("cart-count").textContent=cart.length;}

function renderCart(){
const c=document.getElementById("cart-items");c.innerHTML="";let total=0;
cart.forEach((item,i)=>{
let subtotal=item.price*item.qty;total+=subtotal;
c.innerHTML+=`<div class="d-flex align-items-center mb-2 border-bottom pb-2">
<img src="${item.img}" width="60" class="me-2 rounded">
<div><strong>${item.name}</strong><br>${item.qty} ${item.category==='unite'?'unité(s)':'× 250g = '+item.grams+'g'}<br>
<span class="text-success">${item.price} DH ${item.category==='unite'?'/ unité':'/ 250g'}</span><br>
<span class="fw-bold text-dark">Sous-total: ${subtotal.toFixed(2)} DH</span></div>
<i class="fas fa-trash remove-btn ms-auto" onclick="confirmRemove(${i})"></i></div>`;});
}

function confirmRemove(i){
Swal.fire({title:"Supprimer?",text:"Voulez-vous retirer cet article du panier ?",icon:"warning",showCancelButton:true,confirmButtonText:"Oui, supprimer"}).then(r=>{
if(r.isConfirmed){cart.splice(i,1);updateCartCount();renderCart();Swal.fire("Supprimé!","L'article a été retiré.","success");}
});
}

function validateOrder(){
if(cart.length===0){Swal.fire('Panier vide','Ajoutez un produit','warning');return;}
const n=document.getElementById('client-name').value.trim();
const a=document.getElementById('client-address').value.trim();
const c=document.getElementById('client-comment').value.trim();
if(!n||!a){Swal.fire('Champs manquants','Nom et adresse requis','warning');return;}
let msg=`Bonjour,\nCommande:\n`;let total=0;
cart.forEach((it,i)=>{let q=it.category==='unite'?`${it.qty} unité(s)`:it.grams+"g";let st=it.price*it.qty;total+=st;
msg+=`${i+1}. ${it.name} = ${q} | ${st.toFixed(2)} DH\n`;});
msg+=`Total général: ${total.toFixed(2)} DH\nNom: ${n}\nAdresse: ${a}`;
if(c){msg+=`\nCommentaire: ${c}`;}
const encoded=encodeURIComponent(msg);
window.open(`https://wa.me/212608975435?text=${encoded}`);
Swal.fire('Merci!','Votre commande sera préparée.','success');
cart=[];updateCartCount();renderCart();
document.getElementById('client-name').value='';
document.getElementById('client-address').value='';
document.getElementById('client-comment').value='';
}

document.addEventListener('DOMContentLoaded',()=>renderProducts());
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
